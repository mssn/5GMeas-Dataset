% Template for a HORIZONTAL HISTOGRAM (STACKED) graph
%
% Author: CHUNYI PENG
% Note: to use package fontspec,
% use XeLaTeX to compile

\documentclass{standalone}
\usepackage{siunitx}
% \usepackage{tikz}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
%\usepackage{verbatim}
\usepackage{tikz}
\usepackage{helvet,etoolbox}
%\usepackage{sansmath}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{1pt}
\usetikzlibrary{patterns}
\usetikzlibrary{pgfplots.statistics}

\pgfplotsset{compat=newest}

%\usepackage{fontspec}
%\setmainfont[
%BoldFont={Arial Bold},
%ItalicFont={Arial Italic},
%BoldItalicFont={Arial Bold Italic}
%]{Arial}

%\AtBeginEnvironment{tikzpicture}{\sansmath}
%\AtEndEnvironment{tikzpicture}{\unsansmath}

% # user-study-sync-overhead-context-tx-v2.txt
%\pgfplotstableread{
%0   0
%1000   0.1
%5000   0.8
%10000   0.95
%20000   1
%}{\fakedata}

\makeatletter
\pgfplotsset{
my filter/.style args={every#1between#2and#3}{%
/pgfplots/x filter/.append code={%
\ifnum\coordindex<#2%
  % Nothing
\else% Did we pass #3?
  \ifnum\coordindex>#3%
    %Nothing
  \else% Ok filter is on, don't disturb \pgfmathresult for convenience
    \pgfmathsetmacro\temp{int(mod(\coordindex,#1))}%
    \ifnum0=\temp\relax% Are we on the nth point?
      % Yes do nothing let it pass
    \else% discard it
      \let\pgfmathresult\pgfutil@empty
    \fi%
  \fi%
\fi%
}}}
\makeatother



\pgfplotsset{
    compat=newest,
    legend image code/.code={
        \draw[mark repeat=2,mark phase=2]
        plot coordinates {
            (0cm,0cm)
            (0.3cm,0cm)        %% default is (0.3cm,0cm)
            (0.6cm,0cm)         %% default is (0.6cm,0cm)
        };%
    }
}

\makeatletter
\pgfplotsset{
	boxplot prepared from table/.code={
		\def\tikz@plot@handler{\pgfplotsplothandlerboxplotprepared}%
		\pgfplotsset{
			/pgfplots/boxplot prepared from table/.cd,
			#1,
		}
	},
	/pgfplots/boxplot prepared from table/.cd,
	table/.code={\pgfplotstablecopy{#1}\to\boxplot@datatable},
	row/.initial=0,
	make style readable from table/.style={
		#1/.code={
			\pgfplotstablegetelem{\pgfkeysvalueof{/pgfplots/boxplot prepared from table/row}}{##1}\of\boxplot@datatable
			\pgfplotsset{boxplot/#1/.expand once={\pgfplotsretval}}
		}
	},
	make style readable from table=lower whisker,
	make style readable from table=upper whisker,
	make style readable from table=lower quartile,
	make style readable from table=upper quartile,
	make style readable from table=median,
	make style readable from table=lower notch,
	make style readable from table=upper notch,
}
\makeatother

% \definecolor{palette1}{RGB}{215,25,28}
% \definecolor{palette2}{RGB}{253,174,97}
% % \definecolor{palette3}{RGB}{255,255,191}
% \definecolor{palette3}{RGB}{208,28,139}
% \definecolor{palette4}{RGB}{184,225,134}
% % \definecolor{palette4}{RGB}{171,221,164}
% \definecolor{palette5}{RGB}{43,131,186}
% \definecolor{palette6}{RGB}{208,28,139}

% green -- blueish
% \definecolor{palette1}{RGB}{0,109,44}
% \definecolor{palette2}{RGB}{44,162,95}
% \definecolor{palette3}{RGB}{67,162,202}
% \definecolor{palette4}{RGB}{8,104,172}
% \definecolor{palette5}{RGB}{8,81,156}

\definecolor{myred}{HTML}{C00000}
\definecolor{mypurple}{HTML}{7030A0}
\definecolor{myblue}{HTML}{0070C0}
\definecolor{myblue2}{HTML}{0431FF}
\definecolor{myblue0}{HTML}{0000FF}
\definecolor{mygreen}{HTML}{00B050}
\definecolor{mygray}{HTML}{A6A6A6}

\iffalse
\definecolor{myred}{RGB}{202,0,32}
\definecolor{myorange}{RGB}{244,165,130}
\definecolor{myviolet}{RGB}{194,165,207}
\definecolor{mycyan}{RGB}{146,197,222}
\definecolor{myblue}{RGB}{5,113,176}
\definecolor{mygreen}{RGB}{127,191,123}
\definecolor{mytile}{RGB}{27,120,55}
\definecolor{myblack}{RGB}{60,60,60}
% \definecolor{palette3}{RGB}{247,247,247}
\fi

% \documentclass{standalone}
\usepackage{pgfplots}
% Nice color sets, see see http://colorbrewer2.org/	
\usepgfplotslibrary{colorbrewer}
% initialize Set1-4 from colorbrewer (we're comparing 4 classes),
\pgfplotsset{compat = 1.15, cycle list/Set1-8} 
% Tikz is loaded automatically by pgfplots
\usetikzlibrary{pgfplots.statistics, pgfplots.colorbrewer} 
% provides \pgfplotstabletranspose
\usepackage{pgfplotstable}
\usepackage{filecontents}

\begin{document}

%\begin{tikzpicture}[font=\sffamily]
\begin{tikzpicture}
\begin{axis}[
     ybar stacked,
     xtick=data,
    % y dir=reverse, gb
     axis x line*,
     axis y line*,
    axis y line*=none,
    axis x line*=bottom,
	%
    %ymode = log,
    % boxplot/draw direction=y,
    %ymax    = 200,
    %ymin    = -200,
    height   =  4.5 cm,
    width =  6.5 cm,
   tick label style={/pgf/number format/assume math mode=true},
    xticklabel style={
        yshift = 3pt,
    },
     yticklabel style = {
    %font=\normalsize,
   	yshift =  0 pt,
        xshift =  3 pt,
    },
%    ylabel={{\bf D1} \\ \\ \\ {\bf D2}},
    ylabel style={
        %font=\small,
        % at={(current axis.north west)},
        rotate=-90,
        %text width=2.8cm,
        align=center,
        xshift= 7 pt,
        yshift = -8 pt,
    },
     %tick label style={font=\footnotesize},
    %legend style={font=\footnotesize},
   % label style={font=\footnotesize},
%    xtick={0,0.25,0.5,0.75,1},
%    xticklabels={0{\small \%},25{\small \%},50{\small \%},75{\small \%},100{\small \%}},
    %ytick={0,0.25,0.5,0.75,1},
    %yticklabels={0{\small \%},25{\small \%},50{\small \%},75{\small \%},100{\small \%}},
    ytick={0,0.2,0.4,0.6,0.8,1},
    yticklabels={0\%,20\%,40\%,60\%,80\%,100\%},
    %yticklabels={0{\small \%},25{\small \%},50{\small \%},75{\small \%},100{\small \%}},
    %xticklabel pos=right, 
    %yticklabel pos=bottom,
    %xtick align = inside,
    %width=.9\textwidth,
    bar width=3.5mm,
    %xlabel={Percentage (\%)},
    xticklabels={A1,, A3,, A5,,A7,,A9,,A11},
    ymin=0,
    ymax=1.01,
    ymajorgrids=true,
    area legend,
    %x=5mm,
    enlarge x limits={abs=0.5},
%    legend style={
%    legend columns=2,
%        at={(xticklabel cs:0.5)},
%        anchor=south,
%        draw=none
%    },
legend image code/.code={
        \draw [#1] (0cm,-0.1cm) rectangle (0.3cm,0.15cm); },
	legend style={
	at={(-0.15,1.2)},
	%font    = \small,
	fill    = none,
	draw    = none,
	anchor  = north west,
	column sep=-0.05cm,
	row sep= -0.05cm,
	%row sep= 0cm,
	legend cell align   = left,
	legend columns      = 5,
	nodes={scale=0.9},
},
%            clip=false
]
    
%		\foreach \n in {1,...,3} {
%			\addplot+[boxplot, fill, draw=black] table[y index=\n] {\datatransposed};
%		}    
]

%\addplot[black,fill=myblue0,fill opacity=0.1,postaction={pattern=north east lines,opacity=0.5}] coordinates
%%\addplot[myred,fill=myred] coordinates
%{(0, 68) (1,0) (2,0)};
%%\addplot[black,fill=myblue2,fill opacity=0.1,postaction={pattern=north west lines,opacity=0.5}] coordinates
%\addplot[black,fill=mygray,fill opacity=0.1,postaction={}] coordinates
%{(0,12) (1,0) (2,0)};
%%\addplot[myred,fill=myred,fill opacity=0.25,postaction={pattern=grid,opacity=0.5}] coordinates
%\addplot[black,fill=myblue0,fill opacity=0.1,postaction={}] coordinates
%{(0,20) (1,0) (2,0)};
%%\addplot[black,fill=mygray,fill opacity=0.1,postaction={pattern=north west lines,opacity=0.5}] coordinates
%%{(0,0) (0,1) (39.8,2) (63.6,3)};



% Plot full ratio
\addplot+[
    ybar,
    myred,
    fill=myred,
    %fill opacity=0.5,
    %postaction={pattern=north east lines, opacity=0.5}
] table [
    x=index,
    y=loc_num_75_100_ratio,
    col sep=comma,
] {location_ratio_all_areas.csv};

% Plot high ratio
\addplot+[
    ybar,
    myred,
    fill=myred,
    fill opacity=0.5,
    postaction={pattern=north east lines, opacity=0.1}
] table [
    x=index,
    y=loc_num_50_75_ratio,
    col sep=comma,
] {location_ratio_all_areas.csv};

% Plot medium ratio
\addplot+[
    ybar,
    myred,
    fill=myred,
    fill opacity=0.25,
    %postaction={pattern=north west lines, opacity=0.5}
] table [
    x=index,
    y=loc_num_25_50_ratio,
    col sep=comma,
] {location_ratio_all_areas.csv};

% Plot low ratio
\addplot+[
    ybar,
    myred,
    fill=myred,
    fill opacity=0.1,
    postaction={pattern=north west lines, opacity=0.1}
] table [
    x=index,
    y=loc_num_0_25_ratio,
    col sep=comma,
] {location_ratio_all_areas.csv};

% Plot ZERO ratio ( = 0%)
\addplot+[
    ybar,
    myblue,
    fill=myblue,
    fill opacity=1,
] table [
    x=index,
    y=loc_num_0_0_ratio,
    col sep=comma,
] {location_ratio_all_areas.csv};


%\node[center, text=black, rotate=0] at (axis cs:1.1,2.5) {\bf OP$_{T}$};
%\node[center, text=black, rotate = 0] at (axis cs:1.1,6) {\bf OP$_{A}$};
%\node[center, text=black, rotate = 0] at (axis cs:1.1,8.5) {\bf OP$_{V}$};

%
%  \draw[mark=none, thin, dashed, gray] (axis cs:0,4.75) -- (axis cs:1.2,4.75);
%  \draw[mark=none, thin, dashed, gray] (axis cs:0,7.25) -- (axis cs:1.2,7.25);

%\legend{\textbf{100\%},\textbf{[50\%,100\%)}, \textbf{(0\%,50\%)}, \textbf{0\%}}
%\legend{$\ge$75\%, (75\%, 50\%], (50\%, 25\%], (25\%, 0\%), 0\%}
\legend{$>$75\%,$>$50\%,$>$25\%,$>$0\%,=0\%}

\draw[mark=none, thin, dashed, gray] (axis cs:5.5,0) -- (axis cs:5.5,1.2);
\draw[mark=none, thin, dashed, gray] (axis cs:8.5,0) -- (axis cs:8.5,1.2);
\draw[mark=none, thin, dashed, gray] (axis cs:11.48,0) -- (axis cs:11.48,1.2);


\end{axis}  

\end{tikzpicture}


\end{document}

