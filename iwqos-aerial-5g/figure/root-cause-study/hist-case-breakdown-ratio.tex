% Template for a HORIZONTAL HISTOGRAM (STACKED) graph
%
% Author: CHUNYI PENG
% REVISED FOR MSSN@PURDUE 
% Date: 02/2024
%
% Note: to use package fontspec,
% use XeLaTeX to compile

%\documentclass{article}
\documentclass{standalone}
\usepackage{siunitx}
% \usepackage{tikz}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
%\usepackage{verbatim}
\usepackage{tikz}
\usepackage{helvet,etoolbox}
%\usepackage{sansmath}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{1pt}
\usetikzlibrary{patterns}
\usetikzlibrary{pgfplots.statistics}

\pgfplotsset{compat=newest}

%\usepackage{fontspec}
%\setmainfont[
%BoldFont={Arial Bold},
%ItalicFont={Arial Italic},
%BoldItalicFont={Arial Bold Italic}
%]{Arial}

%\AtBeginEnvironment{tikzpicture}{\sansmath}
%\AtEndEnvironment{tikzpicture}{\unsansmath}

% # user-study-sync-overhead-context-tx-v2.txt
%\pgfplotstableread{
%0   0
%1000   0.1
%5000   0.8
%10000   0.95
%20000   1
%}{\fakedata}

\makeatletter
\pgfplotsset{
my filter/.style args={every#1between#2and#3}{%
/pgfplots/x filter/.append code={%
\ifnum\coordindex<#2%
  % Nothing
\else% Did we pass #3?
  \ifnum\coordindex>#3%
    %Nothing
  \else% Ok filter is on, don't disturb \pgfmathresult for convenience
    \pgfmathsetmacro\temp{int(mod(\coordindex,#1))}%
    \ifnum0=\temp\relax% Are we on the nth point?
      % Yes do nothing let it pass
    \else% discard it
      \let\pgfmathresult\pgfutil@empty
    \fi%
  \fi%
\fi%
}}}
\makeatother



\pgfplotsset{
    compat=newest,
    legend image code/.code={
        \draw[mark repeat=2,mark phase=2]
        plot coordinates {
            (0cm,0cm)
            (0.3cm,0cm)        %% default is (0.3cm,0cm)
            (0.6cm,0cm)         %% default is (0.6cm,0cm)
        };%
    }
}

\makeatletter
\pgfplotsset{
	boxplot prepared from table/.code={
		\def\tikz@plot@handler{\pgfplotsplothandlerboxplotprepared}%
		\pgfplotsset{
			/pgfplots/boxplot prepared from table/.cd,
			#1,
		}
	},
	/pgfplots/boxplot prepared from table/.cd,
	table/.code={\pgfplotstablecopy{#1}\to\boxplot@datatable},
	row/.initial=0,
	make style readable from table/.style={
		#1/.code={
			\pgfplotstablegetelem{\pgfkeysvalueof{/pgfplots/boxplot prepared from table/row}}{##1}\of\boxplot@datatable
			\pgfplotsset{boxplot/#1/.expand once={\pgfplotsretval}}
		}
	},
	make style readable from table=lower whisker,
	make style readable from table=upper whisker,
	make style readable from table=lower quartile,
	make style readable from table=upper quartile,
	make style readable from table=median,
	make style readable from table=lower notch,
	make style readable from table=upper notch,
}
\makeatother

% \definecolor{palette1}{RGB}{215,25,28}
% \definecolor{palette2}{RGB}{253,174,97}
% % \definecolor{palette3}{RGB}{255,255,191}
% \definecolor{palette3}{RGB}{208,28,139}
% \definecolor{palette4}{RGB}{184,225,134}
% % \definecolor{palette4}{RGB}{171,221,164}
% \definecolor{palette5}{RGB}{43,131,186}
% \definecolor{palette6}{RGB}{208,28,139}

% green -- blueish
% \definecolor{palette1}{RGB}{0,109,44}
% \definecolor{palette2}{RGB}{44,162,95}
% \definecolor{palette3}{RGB}{67,162,202}
% \definecolor{palette4}{RGB}{8,104,172}
% \definecolor{palette5}{RGB}{8,81,156}

\definecolor{myred}{RGB}{202,0,32}
\definecolor{myorange}{RGB}{244,165,130}
\definecolor{myviolet}{RGB}{194,165,207}
\definecolor{mycyan}{RGB}{146,197,222}
\definecolor{myblue}{RGB}{5,113,176}
\definecolor{mygreen}{RGB}{127,191,123}
\definecolor{mytile}{RGB}{27,120,55}
\definecolor{myblack}{RGB}{60,60,60}

% \documentclass{standalone}
\usepackage{pgfplots}
% Nice color sets, see see http://colorbrewer2.org/	
\usepgfplotslibrary{colorbrewer}
% initialize Set1-4 from colorbrewer (we're comparing 4 classes),
\pgfplotsset{compat = 1.15, cycle list/Set1-8} 
% Tikz is loaded automatically by pgfplots
\usetikzlibrary{pgfplots.statistics, pgfplots.colorbrewer} 
% provides \pgfplotstabletranspose
\usepackage{pgfplotstable}
\usepackage{filecontents}

\begin{document}

%\begin{tikzpicture}[font=\sffamily]
\begin{tikzpicture}
\begin{axis}[
     xbar stacked,
     ytick=data,
     y dir=reverse,
     axis y line*=none,
     axis x line*=none,
	%
    %ymode = log,
    % boxplot/draw direction=y,
    %ymax    = 200,
    %ymin    = -200,
    width   =  6 cm,
    height  = 5 cm,
%    scale only axis = true,
%    xtick align = inside,
    % bar width   = 1pt,
    % enlarge x limits = auto,
    % xticklabel style = {
    %     font=\small,
    %     % at={(current axis.north west)},
    %     % rotate=-90,
    %     % xshift=-1ex,
    %     yshift = 2pt,
    % },
   tick label style={/pgf/number format/assume math mode=true},
    %ytick = {1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400},
    %yticklabels = {1, 10, , , , , , , , , 100, , , 400},
    %ytick = {1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400},
    %yticklabels =   {1, 10, , , , , , , , , 100, , , 400},
    %xticklabel style = {font=\small},
    %yticklabel style = {font=\small},
%    boxplot/variable width,
%    boxplot/box extend=0.75,
    % % xticklabel pos=right,
    % xtick pos = left,
    % ytick pos = left,
    % % yticklabel pos=right,
    % % enlargelimits=0.15,
    %ylabel={Thput. Delta \small{(Mbps)}},
    %xlabel={BW \small{(MHz)}},
            yticklabel style={
        %font=\normalsize,
        yshift =  0 pt,
        xshift =  3 pt,
    },
    xticklabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        %xshift= -3pt,
        yshift = 3pt,
    },
    ylabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        %text width=2.8cm,
        align=center,
        xshift=0pt,
        yshift = -8 pt,
    },
     %tick label style={font=\footnotesize},
    %legend style={font=\footnotesize},
   % label style={font=\footnotesize},
    xtick={0,25,50,75,100},
    xticklabels={0,25,50,75,100{\small \%}},
    xticklabel pos=right, 
    %xtick align = inside,
    %width=.9\textwidth,
    bar width=3.3mm,
    %xlabel={Percentage (\%)},
    ytick={0, 1, 2, 3, 4, 6, 7, 8},
    yticklabels={120m, 90m, 60m, 30m, 0m, 120m, 60m, 0m},
%    ymin=0,
%    ymax=10,
    xmin=0,
    xmax=100,
    ymin=-0.5,
    ymax=8.5,
    area legend,
    %y=5mm,
    %enlarge y limits={abs=0.5},
%    legend style={
%    legend columns=2,
%        at={(xticklabel cs:0.5)},
%        anchor=south,
%        draw=none
%    },
	legend style={
	at={(0.05,0.95)},
	%font    = \small,
	fill    = none,
	draw    = none,
	anchor  = south west,
	column sep=0cm,
	row sep= -0.05cm,
	legend cell align   = left,
	legend columns      = 3,
},
%    xlabel style={
%        font=\large,
%        % at={(current axis.north west)},
%        % rotate=-90,
%        % xshift=-1ex,
%        xshift = 0 pt,
%        yshift = 3pt,
%    },
    % symbolic x coords={att, tmo, sprint, cmcc, fi},
    % xticklabels={AT\&T, T-Mobile, Sprint, China Mobile, Google-Fi},
    % xtick=data,
    % nodes near coords,
    % nodes near coords align={vertical},
    ]
    
%		\foreach \n in {1,...,3} {
%			\addplot+[boxplot, fill, draw=black] table[y index=\n] {\datatransposed};
%		}    
]

%\addplot[myred,fill=myred,fill opacity=0.6] coordinates
\addplot[myred, 
pattern=north east lines,
pattern color = myred,
%fill=myred,
%fill opacity=0.6
draw=myred,
] coordinates
%\addplot[myred,fill=myred,fill opacity=0.25] coordinates
{ (21.2,0) (35.9,1) (40.4,2) (66.7,3) (32.6,4) (33.8,6) (24.6,7) (28.0,8)};

%\addplot[myorange,fill=myorange,fill opacity=0.4] coordinates
%%\addplot[myred,fill=myred,fill opacity=0.25] coordinates
%{ (0,0) (3.8,1) (5.4,2) (1.8,3) (6.5,4) (4.5,6) (17.1,7) (23.6,8)};

\addplot[myred] coordinates
%\addplot[myred,fill=myred,fill opacity=0.25] coordinates
{ (0,0) (2.6,1) (5.3,2) (1.8,3) (6.5,4) (0,6) (4.6,7) (23.6,8)};

\addplot[myred,fill=myred,fill opacity=1] coordinates
%\addplot[myred,fill=myred,fill opacity=0.25] coordinates
{ (78.8,0) (61.5,1) (54.4,2) (31.6,3) (60.9,4) (66.2,6) (70.8,7) (48.4,8)};

%% data source: \data\dataset-stats.xlxs
%% recovery + not recovery 
%\addplot[myred,fill=myred] coordinates
%%\addplot[myred,fill=myred,fill opacity=0.25] coordinates
%{ (14.7,0) (42.5,1) (25.0,2)};
%\addplot[myred,fill=myred,fill opacity=0.25] coordinates
%{(5.5,0) (25.7,1) (25.0,2)};
%%\addplot[myred,fill=myblue,fill opacity=0.25] coordinates
%\addplot[
%	%pattern=flexible hatch,
%        %hatch distance=5pt,
%        %hatch thickness=0.5pt,
%        draw=myred,
%        pattern color=myblue,
%        ] coordinates
%{ (27.0,0) (2.7,1) (0.0,2)};
%\addplot[myred,fill=myblue] coordinates
%{(52.8,0) (29.2,1) (50.0,2)};
%%\addplot[black,fill=myred,fill opacity=0.5] coordinates
%%{(0,0) (0,1) (0,2) (0,3) };


%\node[text=myred] at (axis cs:75,0.1) {\bf 99.6\%};
%\node[text=myred] at (axis cs:60,1.1) {\bf 80.2\%};
%\node[text=myred] at (axis cs:40,2.1) {\bf 67.1\%};
%\node[text=myred] at (axis cs:40,3.1) {\bf 61.4\%};

%\legend{{\bf \texttt{config}}, {\bf \texttt{report}}, {\bf \texttt{decision}}}
\legend{{\bf{C}}, {\bf{M+R}}, {\bf{H}}}

%\addplot+[mark=none,dashed,gray,line width=1pt] coordinates {(0, 5) (100, 5)};
%
%\node[] at (axis cs: 110,3) {\normalsize {\bf R1}};
%\node[] at (axis cs: 110,7) {\normalsize {\bf A1}};

%\legend{{\bf \texttt{U}}, {\bf \texttt{M}}, {\bf \texttt{R}}, {\bf \texttt{OK}}}
%,CONF}
%,SRB3}

\end{axis}  

\begin{axis}[
     y dir=reverse,
    axis y line*=none,
    axis x line*=bottom,
	%
    %ymode = log,
    % boxplot/draw direction=y,
    %ymax    = 200,
    %ymin    = -200,
    width   =  6 cm,
    height  =  5 cm,
%    scale only axis = true,
%    xtick align = inside,
    % bar width   = 1pt,
    % enlarge x limits = auto,
    % xticklabel style = {
    %     font=\small,
    %     % at={(current axis.north west)},
    %     % rotate=-90,
    %     % xshift=-1ex,
    %     yshift = 2pt,
    % },
   tick label style={/pgf/number format/assume math mode=true},
    %ytick = {1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400},
    %yticklabels = {1, 10, , , , , , , , , 100, , , 400},
    %ytick = {1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400},
    %yticklabels =   {1, 10, , , , , , , , , 100, , , 400},
    %xticklabel style = {font=\small},
    %yticklabel style = {font=\small},
%    boxplot/variable width,
%    boxplot/box extend=0.75,
    % % xticklabel pos=right,
    % xtick pos = left,
    % ytick pos = left,
    % % yticklabel pos=right,
    % % enlargelimits=0.15,
    %ylabel={Thput. Delta \small{(Mbps)}},
    %xlabel={BW \small{(MHz)}},
            yticklabel style={
        %font=\normalsize,
        yshift =  0 pt,
        xshift =  3 pt,
    },
    xticklabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        %xshift= -3pt,
        yshift = 3pt,
    },
    ylabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        %text width=2.8cm,
        align=center,
        xshift=0pt,
        yshift = -8 pt,
    },
     %tick label style={font=\footnotesize},
    %legend style={font=\footnotesize},
   % label style={font=\footnotesize},
    xtick={0,25,50,75,100},
    xticklabels={},
    xticklabel pos=right, 
    %xtick align = inside,
    %width=.9\textwidth,
    %bar width=4mm,
    %xlabel={Percentage (\%)},
    ytick={},
    yticklabels={},
%    ymin=0,
%    ymax=10,
    xmin=0,
    xmax=100,
    ymin=-0.5,
    ymax=8.5,
    clip=false
%    xlabel style={
%        font=\large,
%        % at={(current axis.north west)},
%        % rotate=-90,
%        % xshift=-1ex,
%        xshift = 0 pt,
%        yshift = 3pt,
%    },
    % symbolic x coords={att, tmo, sprint, cmcc, fi},
    % xticklabels={AT\&T, T-Mobile, Sprint, China Mobile, Google-Fi},
    % xtick=data,
    % nodes near coords,
    % nodes near coords align={vertical},
    ]
    
%		\foreach \n in {1,...,3} {
%			\addplot+[boxplot, fill, draw=black] table[y index=\n] {\datatransposed};
%		}    
]


\addplot+[mark=none,dashed,gray,line width=1pt] coordinates {(0, 5) (100, 5)};

\node[] at (axis cs: 107,2) {\normalsize {\bf R1}};
\node[] at (axis cs: 107,7) {{\bf All}};

\end{axis}  


\end{tikzpicture}


\end{document}

