% REVISED FOR MSSN@PURDUE 
% Date: 02/2024
% 
% Note: to use package fontspec,
% use XeLaTeX to compile

%\documentclass{standalone}
\documentclass{article}
\usepackage{siunitx}
% \usepackage{tikz}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
%\usepackage{verbatim}
\usepackage{tikz}
\usepackage{helvet,etoolbox}
%\usepackage{sansmath}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{1pt}
\usetikzlibrary{patterns}
\usetikzlibrary{pgfplots.statistics}

\pgfplotsset{compat=newest}

%\usepackage{fontspec}
%\setmainfont[
%BoldFont={Arial Bold},
%ItalicFont={Arial Italic},
%BoldItalicFont={Arial Bold Italic}
%]{Arial}

%\AtBeginEnvironment{tikzpicture}{\sansmath}
%\AtEndEnvironment{tikzpicture}{\unsansmath}

% # user-study-sync-overhead-context-tx-v2.txt
%\pgfplotstableread{
%0   0
%1000   0.1
%5000   0.8
%10000   0.95
%20000   1
%}{\fakedata}

\makeatletter
\pgfplotsset{
my filter/.style args={every#1between#2and#3}{%
/pgfplots/x filter/.append code={%
\ifnum\coordindex<#2%
  % Nothing
\else% Did we pass #3?
  \ifnum\coordindex>#3%
    %Nothing
  \else% Ok filter is on, don't disturb \pgfmathresult for convenience
    \pgfmathsetmacro\temp{int(mod(\coordindex,#1))}%
    \ifnum0=\temp\relax% Are we on the nth point?
      % Yes do nothing let it pass
    \else% discard it
      \let\pgfmathresult\pgfutil@empty
    \fi%
  \fi%
\fi%
}}}
\makeatother


\makeatletter
\pgfplotsset{
	boxplot prepared from table/.code={
		\def\tikz@plot@handler{\pgfplotsplothandlerboxplotprepared}%
		\pgfplotsset{
			/pgfplots/boxplot prepared from table/.cd,
			#1,
		}
	},
	/pgfplots/boxplot prepared from table/.cd,
	table/.code={\pgfplotstablecopy{#1}\to\boxplot@datatable},
	row/.initial=0,
	make style readable from table/.style={
		#1/.code={
			\pgfplotstablegetelem{\pgfkeysvalueof{/pgfplots/boxplot prepared from table/row}}{##1}\of\boxplot@datatable
			\pgfplotsset{boxplot/#1/.expand once={\pgfplotsretval}}
		}
	},
	make style readable from table=lower whisker,
	make style readable from table=upper whisker,
	make style readable from table=lower quartile,
	make style readable from table=upper quartile,
	make style readable from table=median,
	make style readable from table=lower notch,
	make style readable from table=upper notch,
}
\makeatother

\pgfplotstableread{
	lw lq med  uq uw
1.2	1.8	2.3	2.9	4.6
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
}\datatablea


\pgfplotstableread{
	lw lq med  uq uw
-1 -1 -1 -1 -1
2.8	8.4	12.6	15.5	17.1
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
}\datatableb

\pgfplotstableread{
	lw lq med  uq uw
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
3.1	10	17.7	20.7	23.5
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
}\datatablec

\pgfplotstableread{
	lw lq med  uq uw
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
2.5	10.3	14.3	18.2	20.5
-1 -1 -1 -1 -1
}\datatabled

\pgfplotstableread{
	lw lq med  uq uw
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
-1 -1 -1 -1 -1
3.6	9	14.5	17.4	19.9
}\datatablee

\pgfplotstableread{
	x y
1	7.1
1	0.9
}\outlierdatatablea


\pgfplotstableread{
	x y
2	17.4
2	19.6
2	0
2	0
}\outlierdatatableb

\pgfplotstableread{
	x y
3	25.2
3	2.2
3	24.1
3	0
}\outlierdatatablec

\pgfplotstableread{
	x y
4	1.5
4	1.4
4	22.2
4	1.5
}\outlierdatatabled

\pgfplotstableread{
	x y
5	21
5	27.1
5	3.6
5	2
}\outlierdatatablee

%\definecolor{myred}{RGB}{202,0,32}
%\definecolor{myorange}{RGB}{244,165,130}
%\definecolor{myviolet}{RGB}{194,165,207}
%\definecolor{mycyan}{RGB}{146,197,222}
%\definecolor{myblue}{RGB}{5,113,176}
%\definecolor{mygreen}{RGB}{127,191,123}
%\definecolor{mytile}{RGB}{27,120,55}
%\definecolor{myblack}{RGB}{60,60,60}

\definecolor{myred}{RGB}{200,0,0}
\definecolor{myorange}{RGB}{250,150,100}
\definecolor{myviolet}{RGB}{194,165,207}
\definecolor{mycyan}{RGB}{146,197,222}
\definecolor{myblue}{RGB}{0,100,200}
\definecolor{mygreen}{RGB}{100,200,100}
\definecolor{mytile}{RGB}{27,120,55}
\definecolor{myblack}{RGB}{60,60,60}

%\pgfplotsset{xtick style={draw=none}}

%\if 0
%\pgfplotsset{
%    compat=newest,
%    legend image code/.code={
%        \draw[mark repeat=2,mark phase=2]
%        plot coordinates {
%            (0cm,0cm)
%            (0.3cm,0cm)        %% default is (0.3cm,0cm)
%            (0.6cm,0cm)         %% default is (0.6cm,0cm)
%        };%
%    }
%}
%
%% \documentclass{standalone}
%\usepackage{pgfplots}
%% Nice color sets, see see http://colorbrewer2.org/	
%\usepgfplotslibrary{colorbrewer}
%% initialize Set1-4 from colorbrewer (we're comparing 4 classes),
%\pgfplotsset{compat = 1.15, cycle list/Set1-8} 
%% Tikz is loaded automatically by pgfplots
%\usetikzlibrary{pgfplots.statistics, pgfplots.colorbrewer} 
%% provides \pgfplotstabletranspose
%\usepackage{pgfplotstable}
%\usepackage{filecontents}
%\fi

\begin{document}

%\begin{tikzpicture}[font=\sffamily]
\begin{tikzpicture}
	
\begin{axis}[
    %ymode = log,
    boxplot/draw direction=x,
    xmax    = 25,
    xmin    = 0,
    ymax    = 20, %12.5,
    ymin    = 0.5,
    width   =  2.8 cm,
    height  =  5 cm,
    scale only axis = true,
    xtick align = inside,
    tick label style={/pgf/number format/assume math mode=true},
%    ytick = {2, 6, 10, 14, 18},
%    yticklabels = {0m, 30m, 60m, 90m, 120m},
    xtick = {0, 10, 20, 30},
    xticklabels = {0, 10, 20, 30},
    xmajorgrids=true,
    major grid style={line width=.2pt,draw=gray!50},
    minor tick num=9,
    ytick={}
    boxplot/variable width,
    boxplot/box extend=1.5, % box width
    % % xticklabel pos=right,
    % xtick pos = left,
    % ytick pos = left,
    % % yticklabel pos=right,
    % % enlargelimits=0.15,
    ylabel={},
    xlabel={Std. (Mbps)},
    %xlabel={BW \small{(MHz)}},
    xlabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
       % xshift= -10pt,
        % xshift= 1mm,
         yshift = 5pt,
    },
    ylabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        %text width=2.8cm,
        align=center,
        xshift= 1mm
        yshift = -8 pt,
    },
  yticklabel style={
        %font=\small,
        align=center,
        xshift= 3 pt,
        yshift = 3 pt,
    },
  xticklabel style={
        %font=\small,
        align=center,
        xshift= 1mm,
        yshift = 3pt,
    },
    %xticklabel style={xshift=2mm},
legend style={
	at      = {(1.02, -0.02)},
	%font    = \small,
	fill    = none,
	draw    = none,
	anchor  = south east,
	legend cell align   = left,
	legend columns      = 1,
	row sep = -0.02pt,
},
        %cycle list={{gray},{myblue},{myorange},{myred},{myviolet}},
    ]

\pgfplotstablegetrowsof{\datatablea}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
	\addplot+[
	boxplot prepared from table={
		table=\datatablea,
		row=#1,
		lower whisker=lw,
		upper whisker=uw,
		lower quartile=lq,
		upper quartile=uq,
		median=med,
		%draw position = 1
	},
	boxplot prepared={
		draw position= #1 * 4 + 2 + 0.3,
		every box/.style={very thick,gray,solid},
		every whisker/.style={thick,gray,solid},
		every median/.style={very thick,gray,solid},},
		fill,fill opacity=0.3,
		area legend
	]
coordinates {};
add legend entry 
}


\pgfplotstablegetrowsof{\datatableb}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
	\addplot+[
	boxplot prepared from table={
		table=\datatableb,
		row=#1,
		lower whisker=lw,
		upper whisker=uw,
		lower quartile=lq,
		upper quartile=uq,
		median=med,
		%draw position = 1
	},
	boxplot prepared={
		draw position=#1 * 4 + 2 + 0.225,
		every box/.style={very thick,mygreen,solid},
		every whisker/.style={thick,mygreen,solid},
		every median/.style={very thick,mygreen,solid},},
		fill,fill opacity=0.3,
		area legend
	]
coordinates {};
add legend entry 
}

\pgfplotstablegetrowsof{\datatablec}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
	\addplot+[
	boxplot prepared from table={
		table=\datatablec,
		row=#1,
		lower whisker=lw,
		upper whisker=uw,
		lower quartile=lq,
		upper quartile=uq,
		median=med,
		%draw position = 1
	},
	boxplot prepared={
		draw position=#1 * 4 + 2 + 0.15,
		every box/.style={very thick,myblue,solid},
		every whisker/.style={thick,myblue,solid},
		every median/.style={very thick,myblue,solid},},
		fill,fill opacity=0.3,
		area legend
	]
coordinates {};
add legend entry 
}

\pgfplotstablegetrowsof{\datatabled}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
	\addplot+[
	boxplot prepared from table={
		table=\datatabled,
		row=#1,
		lower whisker=lw,
		upper whisker=uw,
		lower quartile=lq,
		upper quartile=uq,
		median=med,
		%draw position = 1
	},
	boxplot prepared={
		draw position=#1 * 4 + 2 + 0.075,
		every box/.style={very thick,myorange,solid},
		every whisker/.style={thick,myorange,solid},
		every median/.style={very thick,myorange,solid},},
		fill,fill opacity=0.3,
		area legend
	]
coordinates {};
add legend entry 
}

\pgfplotstablegetrowsof{\datatablee}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
	\addplot+[
	boxplot prepared from table={
		table=\datatablee,
		row=#1,
		lower whisker=lw,
		upper whisker=uw,
		lower quartile=lq,
		upper quartile=uq,
		median=med,
		%draw position = 1
	},
	boxplot prepared={
		draw position=#1 * 4 + 2,
		every box/.style={very thick,myred,solid},
		every whisker/.style={thick,myred,solid},
		every median/.style={very thick,myred,solid},},
		fill,fill opacity=0.3,
		area legend
	]
coordinates {};
add legend entry 
}


%\node[text=black] at (axis cs:2,260) {\bf 1};
%\node[text=black] at (axis cs:6,260) {\bf 2};
%\node[text=black] at (axis cs:10,260) {\bf 3};
%\node[text=black] at (axis cs:14,260) {\bf 4};
%\node[text=black] at (axis cs:18,260) {\bf 5};
%\node[text=black] at (axis cs:22,260) {\bf 6};
%\node[text=black] at (axis cs:26,260) {\bf 7};
%\node[text=black] at (axis cs:30,260) {\bf 8};
%\node[text=black] at (axis cs:34,260) {\bf 9};
%\node[text=black] at (axis cs:38,260) {\bf 10};
%\node[text=black] at (axis cs:42,260) {\bf 11};
%\node[text=black] at (axis cs:46,260) {\bf 12};
%\node[text=black] at (axis cs:50,260) {\bf 13};

% OUTLIERS 
\addplot[only marks,draw=gray,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+2+0.3] \outlierdatatablea;
\addplot[only marks,draw=mygreen,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+2+0.225] \outlierdatatableb;
\addplot[only marks,draw=myblue,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+2+0.15] \outlierdatatablec;
\addplot[only marks,draw=myorange,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+2+0.075] \outlierdatatabled;
\addplot[only marks,draw=myred,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+2] \outlierdatatablee;

%\addplot[only marks,draw=black,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+1.5] \outlierdatatablea;
%\addplot[only marks,draw=myblue,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+2] \outlierdatatableb;
%\addplot[only marks,draw=myred,fill=white,mark=*,mark size=2pt,fill opacity=0.6] table[x=y,y expr=(\thisrow{x} - 1)*4+2.5] \outlierdatatablec;

%\filldraw [draw=myred, fill = myred,fill opacity=0.1, thick] (1,-66) rectangle (2.3,-62);
%\node[,right] at (axis cs: 2.3,-64) {\normalsize Failure};
%
%\filldraw [draw=myblue, fill = myblue,fill opacity=0.1, thick] (1,-74) rectangle (2.3,-70);
%\node[,right] at (axis cs: 2.3,-72) {\normalsize Normal};

%\legend{\texttt{Failure}, \texttt{Normal}}

%\addplot+[mark=none, densely dashed,gray,line width=0.5pt] coordinates {(3,-150) (3,0)};
%\addplot+[mark=none, densely dashed,gray,line width=0.5pt] coordinates {(6,-150) (6,0)};

%\legend{all (no RSRP limit), RSRP $\ge$ -120dBm, RSRP $\ge$ -100dBm}
%\legend{All, $\ge$-120dBm, $\ge$-100dBm}
%\legend{4G,All}

%\filldraw [draw=myred, fill = myred,fill opacity=0.1, thick] (1.4,105) rectangle (2,115);
%\node[,right] at (axis cs: 2,110) {\normalsize U};
%
%\filldraw [draw=myblue, fill = myblue,fill opacity=0.1, thick] (3.4,105) rectangle (4,115);
%\node[,right] at (axis cs: 4,110) {\normalsize Others};

% manually add x-axis
\addplot[mark=none, solid,black,line width=0.5pt] coordinates {(0,4.3) (70,4.3)} ;
\addplot[mark=none, solid,black,line width=0.5pt] coordinates {(0,8.225) (70,8.225)};
\addplot[mark=none, solid,black,line width=0.5pt] coordinates {(0,12.15) (70,12.15)};
\addplot[mark=none, solid,black,line width=0.5pt] coordinates {(0,16.075) (70,16.075)};

\node[font=\normalsize, right]at (axis cs: -0.2,3.6) {\textbf{0m}};
\node[font=\normalsize, right]at (axis cs: -0.2,7.525) {\textbf{30m}};
\node[font=\normalsize, right]at (axis cs: -0.2,11.45) {\textbf{60m}};
\node[font=\normalsize, right]at (axis cs: -0.2,15.375) {\textbf{90m}};
\node[font=\normalsize, right]at (axis cs: -0.2,19.3) {\textbf{120m}};

\node[font=\normalsize, center, gray]at (axis cs: 15, 1.5) {\textbf{(median)}};
\node[font=\normalsize, center, gray]at (axis cs: 15, 2.5) {\textbf{2.3Mbps}};
\node[font=\normalsize, center,mygreen]at (axis cs: 15, 4.75) {{\bf 12.6Mbps}};
\node[font=\normalsize, center,myblue]at (axis cs: 15,8.75) {{\bf 17.7Mbps}};
\node[font=\normalsize, center,myorange]at (axis cs: 15,12.75) {{\bf 14.3Mbps}};
\node[font=\normalsize, center,myred]at (axis cs: 15,16.75) {{\bf 14.5Mbps}};

%\addplot+[mark=none, densely dashed,gray,line width=0.2pt] coordinates {(0,300) (4,300)};
%\node[,right] at (axis cs: 1.25, 400) {\small 300 Mbps};

% replot median in RED
%\addplot+[mark=none, very thick,solid,red] coordinates {(0.75,13.3) (1.25,13.3)};
%\addplot+[mark=none, very thick,solid,red] coordinates {(1.75,23.9) (2.25,23.9)};
%\addplot+[mark=none, very thick,solid,blue] coordinates {(2.75,165.1) (3.25,165.1)};


%\draw[gray,densely dashed,->,line width=0.2pt] (axis cs:1.25,13) -- (axis cs: 1.5,1.5);
%\node[,right] at (axis cs: 1.25,1.5) {\small 13.0};
%\draw[gray,densely dashed,->,line width=0.2pt] (axis cs:2.75,21.8) -- (axis cs: 3,6);
%\node[,right] at (axis cs: 2,6) {\small 21.8};
%\node[,right] at (axis cs: 1,300) {\small 164.5};

%\addplot+[mark=none, densely dashed,red,line width=0.2pt] coordinates {(0,13.3) (1.25,13.3)};
%\addplot+[mark=none, densely dashed,red,line width=0.2pt] coordinates {(2,23.9) (2.75,23.9)};
%\addplot+[mark=none, densely dashed,blue,line width=0.2pt] coordinates {(2.25,165.1) (3.5,165.1)};
%
%\draw[myblack,densely dashed,line width=0.2pt] (axis cs:1.25,13.3) -- (axis cs: 1.5,3);
%\node[red,right] at (axis cs: 1,2) {\small 13.3};
%\draw[red,densely dashed,line width=0.2pt] (axis cs:2.75,23.9) -- (axis cs: 3,7);
%\node[red,right] at (axis cs: 2,6) {\small 23.9};
%\draw[blue,densely dashed,line width=0.2pt] (axis cs:2.25,165.1) -- (axis cs: 1.5,300);
%\node[blue,right] at (axis cs: 1, 340) {\small 165.1};

%13
%21.8
%164.5

%\addplot+ [onlymarks,draw=black,mark=*,mark size=0.5pt,mark options={fill=black,},
%]table[x=x,y=y] \outlierdatatable;
%coordinates { 
%	(1,0)
%	(1, 100)
%	(2, 100)
%	(2, 100)
%};


\end{axis}
\end{tikzpicture}

\end{document}

